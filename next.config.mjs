// @ts-check
'use strict';

import { deepMergeConfig } from '@-xun/symbiote/assets';
import { moduleExport } from '@-xun/symbiote/assets/next.config.mjs';
import { createDebugLogger } from 'rejoinder';

const debug = createDebugLogger({ namespace: 'symbiote:config:next' });

/**
 * @type {import('next').NextConfig}
 */
const baseConfig = moduleExport({
  derivedAliases: getNextJsAliases(),
  projectRoot: import.meta.dirname,
  configureWebpack(currentConfig) {
    return currentConfig;
  }
});

const config = deepMergeConfig(baseConfig, {
  // Any custom configs here will be deep merged with moduleExport's result
  // ! Take care not to overwrite certain configs (e.g. baseConfig.webpack)
});

export default config;

debug('exported config: %O', config);

function getNextJsAliases() {
  // ! These aliases are auto-generated by symbiote. Instead of modifying them
  // ! directly, consider regenerating aliases across the entire project with:
  // ! `npx symbiote project renovate --regenerate-assets --assets-preset ...`
  return {
    'multiverse+backend:*': 'packages/backend/src/*',
    'multiverse+shared:*': 'packages/shared/src/*',
    'multiverse+backend$': 'packages/backend/src/index.ts',
    'multiverse+shared$': 'packages/shared/src/index.ts',
    'universe+backend:*': 'packages/backend/src/*',
    'universe+shared:*': 'packages/shared/src/*',
    'universe+backend$': 'packages/backend/src/index.ts',
    'universe+shared$': 'packages/shared/src/index.ts',
    'universe:*': 'src/*',
    universe$: 'src/index.ts',
    'testverse+backend:*': 'packages/backend/test/*',
    'testverse+shared:*': 'packages/shared/test/*',
    'testverse:*': 'test/*',
    'typeverse:*': 'types/*',
    'rootverse+backend:*': 'packages/backend/*',
    'rootverse+shared:*': 'packages/shared/*',
    'rootverse:*': '*'
  };
}
